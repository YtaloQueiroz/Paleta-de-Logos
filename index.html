<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>LogoLens 2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-slate-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const rgbToHex = (r,g,b) =>
      '#' + [r,g,b].map(v => v.toString(16).padStart(2,'0')).join('').toUpperCase();

    function extractColors(img, limit = 8) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      ctx.drawImage(img,0,0);

      const data = ctx.getImageData(0,0,canvas.width,canvas.height).data;
      const map = {};

      for (let i=0;i<data.length;i+=40) {
        const [r,g,b,a] = data.slice(i,i+4);
        if (a < 200) continue;
        const hex = rgbToHex(r,g,b);
        map[hex] = (map[hex] || 0) + 1;
      }

      return Object.entries(map)
        .sort((a,b)=>b[1]-a[1])
        .slice(0,limit)
        .map(e=>e[0]);
    }

    function App() {
      const [images, setImages] = useState([]);

      const handleUpload = e => {
        const files = [...e.target.files];
        files.forEach(file => {
          const reader = new FileReader();
          reader.onload = ev => {
            const img = new Image();
            img.src = ev.target.result;
            img.onload = () => {
              const colors = extractColors(img);
              setImages(prev => [...prev, { name:file.name, src:img.src, colors }]);
            };
          };
          reader.readAsDataURL(file);
        });
      };

      return (
        <div className="max-w-6xl mx-auto p-8 space-y-10">
          <header className="flex items-center gap-4">
            <div className="bg-indigo-600 text-white px-4 py-2 rounded-xl font-black">
              LogoLens 2.0
            </div>
            <p className="text-slate-500 text-sm">Analisador de paleta cromática</p>
          </header>

          <label className="border-2 border-dashed rounded-3xl p-16 text-center block cursor-pointer hover:border-indigo-400 bg-white">
            <input type="file" multiple accept="image/*" className="hidden" onChange={handleUpload} />
            <p className="font-bold text-lg">Clique ou arraste logos aqui</p>
            <p className="text-slate-400 text-sm mt-2">Extração automática de cores</p>
          </label>

          {images.map((img,idx)=>(
            <div key={idx} className="bg-white rounded-3xl shadow p-6 space-y-4">
              <h3 className="font-bold">{img.name}</h3>
              <img src={img.src} className="max-h-64 object-contain" />
              <div className="flex gap-3 flex-wrap">
                {img.colors.map(c=>(
                  <div key={c} className="w-16 text-center">
                    <div className="w-16 h-16 rounded-xl border shadow" style={{background:c}}></div>
                    <span className="text-xs font-mono">{c}</span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
